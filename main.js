(()=>{var u;function n(){return u||(u=new f),u}var f=class{constructor(){this.images=new Map([["sprites-16x16",null]])}async Init(){let e=[];e.push(...[...this.images.keys()].map(i=>new Promise(t=>{let s=document.createElement("img");s.src=`./assets/${i}.png`,s.id=i,s.onload=()=>t(),document.body.appendChild(s)}))),e.push(...[...this.images.keys()].map(i=>new Promise(async t=>{let b=await(await fetch(`./assets/${i}.json`)).json();this.images.set(i,b),console.log(b),t()}))),await Promise.all(e)}GetTexture(e){return document.getElementById(e)}};var w;function a(){return w||(w=new S),w}var S=class{constructor(){this.actionsToKeys=new Map([[0,"ArrowRight"],[1,"ArrowLeft"],[2,"ArrowDown"],[3,"ArrowUp"]]);this.keys=new Map;window.addEventListener("keydown",e=>{this.handleEvent(e)}),window.addEventListener("keyup",e=>{this.handleEvent(e)})}handleEvent(e){this.keys.set(e.key,e.type==="keydown"?3:2)}Update(){for(let e of this.keys.keys())this.keys.set(e,this.keys.get(e)&1)}Get(e){let i=this.actionsToKeys.get(e);return i?this.keys.get(i):0}};var p=class{constructor(){this.state=new Map}Update(e){this.stateLogic(),this.state.get(0)&&(e.x++,e.renderData.flipped=!1),this.state.get(1)&&(e.x--,e.renderData.flipped=!0),this.state.get(2)&&e.y++,this.state.get(3)&&e.y--}},c=class extends p{stateLogic(){this.state.set(1,!0)}},m=class extends p{constructor(i=a()){super();this.inputService=i}stateLogic(){this.state.set(0,!!(this.inputService.Get(0)&1)),this.state.set(1,!!(this.inputService.Get(1)&1)),this.state.set(2,!!(this.inputService.Get(2)&1)),this.state.set(3,!!(this.inputService.Get(3)&1))}};var v=class{Update(e){e.x<-32&&(e.x+=300)}};var o=class{constructor(){this.x=0;this.y=0;this.renderData={texture:null,flipped:!1,frameX:0,frameY:0,tileWidth:32,tileHeight:32}}Update(){for(let e of this.components)e.Update(this)}Draw(e){e.DrawSprite(this.x,this.y,this.renderData)}};var h=class extends o{constructor(i,t,s=n()){super();this.x=i;this.y=t;this.assetsService=s;this.components=[new c,new v];this.renderData.texture=this.assetsService.GetTexture("sprites-16x16")}};var l=class extends o{constructor(i=n()){super();this.assetsService=i;this.components=[new m];this.renderData.texture=this.assetsService.GetTexture("sprites-16x16")}};function y(){return[new l,new h(256,64)]}var g;function M(){return g||(g=new x),g}var x=class{constructor(){this.canvas=document.getElementById("c"),this.ctx=this.canvas.getContext("2d"),this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){let e,i;e=window.innerWidth/this.canvas.width,i=window.innerHeight/this.canvas.height;let t=Math.min(e,i);t>=1&&(t=Math.floor(t)),this.canvas.style.width=`${this.canvas.width*t}px`,this.canvas.style.height=`${this.canvas.height*t}px`}Clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}DrawSprite(e,i,t){let s=1;t.flipped&&(this.ctx.scale(-1,1),s=-1),this.ctx.drawImage(t.texture,1+t.frameX*(t.tileWidth+1),1+t.frameY*(t.tileHeight+1),t.tileWidth,t.tileHeight,e*s-(s<0?t.tileWidth:0),i,t.tileWidth,t.tileHeight),t.flipped&&this.ctx.scale(-1,1)}};var d=class{constructor(e=n(),i=a(),t=M()){this.assetsService=e;this.inputService=i;this.renderService=t;this.entities=[];this.scene=y}async Init(){await this.assetsService.Init(),requestAnimationFrame(e=>{this.start=e,this.frame(e)})}frame(e){this.scene!=null&&(this.entities=this.scene(),this.scene=null),this.Update(),this.Draw(),requestAnimationFrame(i=>{this.frame(i-this.start),this.start=i})}Update(){for(let e of this.entities)e.Update();this.inputService.Update()}Draw(){this.renderService.Clear();for(let e of this.entities)e.Draw(this.renderService)}};window.addEventListener("load",async()=>{await new d().Init()});})();
